define(["jquery","image","jqEventEmitter","underscore"],function(e,t,n,n){var r=function(e){_.bindAll(this),this.options=_.extend({tilesize:100},e),this.$el=e.$el,this.criteria=e.criteria,this.artworks={},this.images=[],this.initialize()};return e.extend(r.prototype,e.eventEmitter),r.prototype.initialize=function(){console.log("Tile view initialized"),$w=e(window),this.wDimensions={height:$w.height(),width:$w.width()}},r.prototype.fetch=function(t,n){var r=this,i=e.ajax({beforeSend:function(){e.mobile.showPageLoadingMsg()},url:this.options.restEndpoint,type:"GET",dataType:"json",data:_.extend({},{request:"filter"},n),cache:!1});this.emit("fetch-start"),i.done(function(e,n,i){t==="reset"?r.artworks=e.artworks:t==="merge"&&_.each(e.artworks,function(e,t){r.artworks[t]=e}),console.log(r.artworks),r.emit("fetch-ready")}),i.fail(function(e,t,n){}),i.always(function(t,n,r){e.mobile.hidePageLoadingMsg()})},r.prototype.addTile=function(n,r){var i=this,s=new t({src:n,data:r}),o=e("<li></li>");o.css({height:this.options.tilesize,width:this.options.tilesize}).append(s),this.$el.append(o),this.images.push(s)},r.prototype.build=function(e){var t=this;e==="reset"&&this.reset(),_.each(this.artworks,function(e,n){if(!e.__tiled||typeof e.__tiled=="undefined"){var r=t._selectTile(e,t.wDimensions),i={id:n,images:e.images};t.addTile(r,i),e.__tiled=!0}}),this.emit("tiles-built")},r.prototype.reset=function(){this.images=[],this.$el.html("")},r.prototype._selectTile=function(e,t){t=t?t:this.wDimensions;var n=e.images;return t.width<500?n.tile100?n.tile100:n.original:t.width<1e3?n.tile100?n.tile100:n.original:n.tile100?n.tile100:n.original},r});